/*1317674397,169775557*/

if (window.CavalryLogger) { CavalryLogger.start_js(["0SuZl"]); }

var ExternalNodeConnectWidget=function(i){copy_properties(this,{widgetID:i.widgetID,widget:$(i.widgetID),viewerID:i.viewer,nodeType:i.nodeType,viewerIsAdmin:i.viewerIsAdmin&&!i.userOptedOut,adminUrl:i.adminUrl,popupOptInParams:{},nodeUri:new URI(i.nodeURL),externalUrl:i.externalURL,pageId:i.pageId,layout:i.layout,edgeType:i.edgeType,error:i.error,errorURI:new URI('/'),alreadyConnected:i.alreadyConnected,usingConnectLibrary:!!i.channelURL,commentWidgetMarkup:i.commentWidgetMarkup,commentWidgetOpen:false,commentWidgetVisible:false,userProfile:null,connectStoryFbid:0,isAmbiguousText:i.isAmbiguousText,socialBar:i.socialbar,useDisconnectLink:i.useDisconnectLink,showError:i.showError,showConfirm:i.showConfirm,showFaces:i.showFaces,connectText:i.connectText,ref:i.ref,userOptedOut:i.userOptedOut,usingInlineCommenting:i.usingInlineCommenting,mobile:i.mobile,supportCommenting:!i.mobile&&(!!i.channelURL||i.usingInlineCommenting),inlineCommentListenersInitialized:false,inlineCommentFocused:false,forceCommentHooks:i.forceCommentHooks,nux:i.nux,iframeReferer:i.iframeReferer,isBlocked:i.isBlocked,isPersonalized:i.isPersonalized,confirmedConnect:i.confirmedConnect,hasSend:i.send,colorScheme:i.colorScheme,grayOut:i.grayOut});if(this.usingConnectLibrary)UnverifiedXD.init({autoResize:i.autoResize,channelUrl:i.channelURL,resizeWidth:i.autoResize&&i.layout!==ExternalNodeConnectWidget.STANDARD_LAYOUT});this.connectButtonSlider=DOM.scry(this.widget,'div.connect_button_slider');this.connectButtonContainer=null;if(this.connectButtonSlider.length){this.connectButtonSlider=this.connectButtonSlider[0];this.connectButtonContainer=DOM.find(this.connectButtonSlider,'div.connect_button_container');}else this.connectButtonSlider=null;this.connectButton=DOM.find(this.widget,'a.connect_widget_like_button');if(this.grayOut)this.tombstoneCross=DOM.find(this.widget,'div.tombstone_cross');this.connectedMessage=DOM.scry(this.widget,'span.connect_widget_connected_text');this.connectedMessage=this.connectedMessage.length?this.connectedMessage[0]:null;this.notConnectedMessage=DOM.scry(this.widget,'span.connect_widget_not_connected_text');this.notConnectedMessage=this.notConnectedMessage.length?this.notConnectedMessage[0]:null;this.adminSpans=DOM.scry(this.widget,'span.connect_widget_admin_span');if(this.adminSpans.length>0){this.adminLinks=[];for(var a=0;a<this.adminSpans.length;a++)this.adminLinks[a]=DOM.find(this.adminSpans[a],'a.connect_widget_admin_option');}if(this.layout==ExternalNodeConnectWidget.STANDARD_LAYOUT){this.confirmationCell=DOM.find(this.widget,'div.connect_confirmation_cell');this.userActionTextSpan=DOM.find(this.confirmationCell,'span.connect_widget_user_action');this.summaryTextSpan=DOM.find(this.confirmationCell,'span.connect_widget_summary');this.summaryText=DOM.find(this.confirmationCell,'div.connect_widget_text_summary');var j=DOM.scry(this.widget,'div.connect_widget_sample_connections');this.sampleConnections=j.length>0?j[0]:null;if(i.showFaces&&i.viewer>0){var e=DOM.scry(this.widget,'div.connect_widget_logged_in_user');this.loggedInUserPhotoDiv=e.length>0?e[0]:null;}}if(this.layout===ExternalNodeConnectWidget.SIMPLE_LAYOUT){this.originalButtonWidth=this.computeButtonDimensions().width;this.summaryIncluding=DOM.find(this.widget,'td.connect_widget_simple_including');this.supportCommenting=false;this.usingInlineCommenting=false;}this.setQueryData();if(this.pageId)copy_properties(this.popupOptInParams,{connect_id:this.pageId});this.errorSpans=DOM.scry(this.widget,'span.connect_widget_error_span');if(this.errorSpans.length>0){this.errorLinks=[];for(var b=0;b<this.errorSpans.length;b++)this.errorLinks[b]=DOM.find(this.errorSpans[b],'a.connect_widget_error_text');}this.confirmSpans=DOM.scry(this.widget,'span.connect_widget_confirm_span');if(this.confirmSpans.length>0){this.confirmLinks=[];for(var d=0;d<this.confirmSpans.length;d++)this.confirmLinks[d]=DOM.find(this.confirmSpans[d],'a.connect_widget_confirm_link');}this.unlikeSpans=DOM.scry(this.widget,'span.unlike_span');this.unlikeLinks=[];for(var c=0;c<this.unlikeSpans.length;c++){this.unlikeLinks[c]=DOM.find(this.unlikeSpans[c],'a.connect_widget_unlike_link');Event.listen(this.unlikeLinks[c],'click',this.connectToNodeOnClick.bind(this));}var h=DOM.scry(this.widget,'div.connect_widget_number_cloud');if(h.length==1){this.numberCloud=h[0];this.numberCloudNub=DOM.find(this.widget,'div.connect_widget_number_cloud_nub');this.numberCloudExtension=DOM.find(this.numberCloud,'div.connect_widget_number_cloud_extension');this.sizeNumberCloud();this.numberCloudUnlikeSpan=DOM.find(this.numberCloudExtension,'span.unlike_span');this.numberCloudReminderSpan=DOM.find(this.numberCloudExtension,'span.like_reminder');this.inAnimation=false;this.reminderIsVisible=CSS.hasClass(this.numberCloudUnlikeSpan,'hidden_elem');Event.listen(this.numberCloud,'mouseleave',this.restoreReminderSpan.bind(this));Event.listen(this.numberCloudExtension,'mouseleave',this.restoreReminderSpan.bind(this));Event.listen(this.numberCloudExtension,'mouseenter',this.exposeUnlikeSpan.bind(this));Event.listen(this.numberCloud,'mouseenter',this.exposeUnlikeSpan.bind(this));Event.listen(this.numberCloudExtension,'mouseleave',function(event){this.requiresMouseLeaveEvent=false;}.bind(this));}if(this.usingInlineCommenting&&!this.showFaces){this.shareCommentSpans=DOM.scry(this.widget,'span.connect_widget_share_comment_span');for(var f=0;f<this.shareCommentSpans.length;f++){var k=DOM.find(this.shareCommentSpans[f],'a.connect_widget_share_comment_option');Event.listen(k,'click',function(event){for(var l=0;l<this.shareCommentSpans.length;l++)CSS.addClass(this.shareCommentSpans[l],'hidden_elem');this.presentCommentingOption();}.bind(this));}}if(this.layout===ExternalNodeConnectWidget.BUTTON_COUNT_LAYOUT){XD.forced_min_width=this.getButtonCountWidgetWidth();this.numberExcluding=DOM.find(this.widget,'td.connect_widget_button_count_excluding');this.summaryIncluding=DOM.find(this.widget,'td.connect_widget_button_count_including');this.thumbsUpIcon=DOM.find(this.summaryIncluding,'div.thumbs_up');this.undoRegion=DOM.find(this.summaryIncluding,'div.undo');this.originalButtonWidth=this.computeButtonDimensions().width;Event.listen(this.thumbsUpIcon,'mouseenter',function(event){this.undoButton=DOM.find(this.undoRegion,'label.undo_button input');Event.listen(this.undoButton,'click',this.connectToNodeOnClick.bind(this));CSS.addClass(this.thumbsUpIcon,'hidden_elem');CSS.removeClass(this.undoRegion,'hidden_elem');}.bind(this));Event.listen(this.undoRegion,'mouseleave',function(event){CSS.removeClass(this.thumbsUpIcon,'hidden_elem');CSS.addClass(this.undoRegion,'hidden_elem');}.bind(this));}if(!this.isBlocked){Event.listen(this.connectButton,'click',this.primaryLikeButtonOnClick.bind(this));if(this.grayOut)Event.listen(this.tombstoneCross,'click',this.connectToNodeOnClick.bind(this));}if(this.adminLinks)for(var a=0;a<this.adminLinks.length;a++)Event.listen(this.adminLinks[a],'click',this.presentAdminPage.bind(this));if(this.errorLinks)for(var a=0;a<this.errorLinks.length;a++)Event.listen(this.errorLinks[a],'click',this.presentErrorDialog.bind(this));if(this.confirmLinks)for(var g=0;g<this.confirmLinks.length;g++)Event.listen(this.confirmLinks[g],'click',this.presentConfirmDialog.bind(this));if(i.showCaptcha){this.showCaptcha=true;this.connectToNode(true);}if(this.forceCommentHooks)this.setupCommentHooks($(this.forceCommentHooks));this.textInputMarginWithButton=5;this.widthSyncArbiter=Arbiter.subscribe('platform/socialplugins/send/resize',this.syncSendWidgetWidth.bind(this));Arbiter.inform('platform/socialplugins/like/resize',{button_width:this.computeButtonDimensionsWithPadding().width,widget_width:Vector2.getElementDimensions(this.widget).x,layout:this.layout},Arbiter.BEHAVIOR_STATE);Arbiter.subscribe('platform/socialplugins/dialog',function(m,l){if(l.controllerID!==this.widgetID)this.otherCommentWidgetOpen=(l.event=='open');}.bind(this));this.subscribeToSync(i);};copy_properties(ExternalNodeConnectWidget,{STANDARD_LAYOUT:'standard',BOX_COUNT_LAYOUT:'box_count',BUTTON_COUNT_LAYOUT:'button_count',SIMPLE_LAYOUT:'simple',COLOR_DARK:0,COLOR_LIGHT:1,OPT_IN_FACEBOOK_APP_ID:'127760087237610',updateLoggedInUser:function(b){var a=ExternalNodeConnectWidget.controllerManagingLogin;a.setLoggedIn(b);a.connectToNode(true);a.userOptedOut=false;delete ExternalNodeConnectWidget.controllerManagingLogin;Arbiter.inform('platform/socialplugins/login',{user:b.user},Arbiter.BEHAVIOR_STATE);WidgetArbiter.inform('platform/socialplugins/login',{user:b.user},Arbiter.BEHAVIOR_STATE);},onCommentWidgetLoaded:function(a){var b=ExternalNodeConnectWidget.self;delete ExternalNodeConnectWidget.self;b.injectCommentWidgetMarkup(a);}});copy_properties(ExternalNodeConnectWidget.prototype,{getSyncEndpointName:function(){},getConnectionEndpointName:function(){},getPluginName:function(){},subscribeToSync:function(a){Arbiter.subscribe('platform/socialplugins/login',function(c,b){if(this.viewerID&&b.user!==this.viewerID)document.location.reload();}.bind(this));Arbiter.subscribe(this.getSyncEndpointName(),function(c,b){if(b.externalUrl==a.externalURL){this.userOptedOut=false;this.updateWidget(b.opts,true);}}.bind(this));},setQueryData:function(){copy_properties(this.popupOptInParams,{protocol:window.location.protocol,external_page_url:this.externalUrl});if(this.nux)copy_properties(this.popupOptInParams,{nux:this.nux,referer:this.iframeReferer});},updateWidget:function(e,d,b){var a=(this.alreadyConnected!=e.nowConnected)||(this.showConfirm!=e.showConfirm);if(!d)Arbiter.inform(this.getConnectionEndpointName(),e,Arbiter.BEHAVIOR_STATE);this.alreadyConnected=e.nowConnected;this.viewerIsAdmin=e.isAdmin;this.showError=e.showError;this.showConfirm=e.showConfirm;this.adminUrl=e.adminUrl;this.userProfile=e.userProfile;this.connectStoryFbid=e.connectStoryFbid;this.error=e.error;if(!e.nowConnected)this.closeCommentWidget();if(a&&!d||b){var c=e.nowConnected?'edgeCreated':'edgeRemoved';UnverifiedXD.send({type:c});}if(a||this.error)this.syncWidgetDisplay();if(!d||b)WidgetArbiter.inform(this.getSyncEndpointName(),{externalUrl:this.externalUrl,opts:e},Arbiter.BEHAVIOR_STATE);},presentOptIn:function(){ExternalNodeConnectWidget.controllerManagingLogin=this;PlatformOptInPopup.open(this.getPluginName(),'opt.inlike',this.popupOptInParams);UnverifiedXD.send({type:'authPrompted'});},setLoggedIn:function(a){this.viewerID=a.user;this.newProfilePic=a.profilePic;this.placeFormUserCheck(a.formUserCheck,a.fbDtsg);},placeFormUserCheck:function(b,a){window.Env.fb_dtsg=a;if(ge('post_form_id')){DOM.replace($('post_form_id'),HTML(b));}else DOM.appendContent(DOM.find(document,'body'),HTML(b));},syncWidgetWithServer:function(c){var b=c.getPayload();if(b.requires_login){this.updateWidget({nowConnected:false,isAdmin:false},false);this.presentOptIn();return;}var a={nowConnected:b.success&&b.already_connected,isAdmin:b.is_admin,showError:b.show_error,showConfirm:b.show_confirm,adminUrl:b.admin_url,userProfile:b.user_profile,connectStoryFbid:b.story_fbid,error:b.error_info};this.updateWidget(a,!b.success,b.success);if(b.success&&this.showCaptcha){window.opener.location.reload();window.close();}},getButtonCountWidgetWidth:function(){var a=DOM.find(this.widget,'table.connect_widget_interactive_area');var b=CSS.getStyle(a,'width');return parseInt(b,10);},sizeNumberCloud:function(){this.collapsedNumberCloudHeight=this.getCollapsedNumberCloudHeight();this.expandedNumberCloudHeight=this.collapsedNumberCloudHeight+this.getNumberCloudExtensionHeight();if(this.alreadyConnected)CSS.setStyle(this.numberCloud,'height',this.expandedNumberCloudHeight+'px');var a=this.computeButtonDimensionsWithPadding().width;XD.forced_min_width=a;var b=intl_locale_is_rtl();a-=2;CSS.setStyle(this.numberCloud,'width',a+'px');CSS.setStyle(this.numberCloud,'visibility','visible');animation(this.numberCloud).from('opacity',0).to('opacity',1).duration(100).go();},getCollapsedNumberCloudHeight:function(){var b=Vector2.getElementDimensions(this.numberCloud).y;var d=parseInt(CSS.getStyle(this.numberCloud,'paddingTop'),10);var c=parseInt(CSS.getStyle(this.numberCloud,'paddingBottom'),10);var a=parseInt(CSS.getStyle(this.numberCloud,'border'),10);return b-d-c-2;},getNumberCloudExtensionHeight:function(){CSS.addClass(this.numberCloudExtension,'connect_widget_offscreen');if(!this.alreadyConnected)CSS.removeClass(this.numberCloudExtension,'hidden_elem');var a=Vector2.getElementDimensions(this.numberCloudExtension).y;if(!this.alreadyConnected)CSS.addClass(this.numberCloudExtension,'hidden_elem');CSS.removeClass(this.numberCloudExtension,'connect_widget_offscreen');return a;},restoreReminderSpan:function(event){if(this.reminderIsVisible||this.inAnimation)return;this.animateReminderSpanReappearance();},animateReminderSpanReappearance:function(){if(this.reminderIsVisible||this.inAnimation)return;this.inAnimation=true;CSS.addClass(this.numberCloudUnlikeSpan,'hidden_elem');CSS.setStyle(this.numberCloudReminderSpan,'opacity',0);CSS.removeClass(this.numberCloudReminderSpan,'hidden_elem');animation(this.numberCloudReminderSpan).to('opacity',1).duration(100).ondone(function(){this.inAnimation=false;this.reminderIsVisible=true;}.bind(this)).go();},exposeUnlikeSpan:function(event){if(!this.alreadyConnected||this.requiresMouseLeaveEvent||!this.reminderIsVisible||this.inAnimation)return;this.inAnimation=true;CSS.addClass(this.numberCloudReminderSpan,'hidden_elem');CSS.setStyle(this.numberCloudUnlikeSpan,'opacity',0);CSS.removeClass(this.numberCloudUnlikeSpan,'hidden_elem');animation(this.numberCloudUnlikeSpan).to('opacity',1).duration(100).ondone(function(){this.inAnimation=false;this.reminderIsVisible=false;}.bind(this)).go();},conditionallyActivateButton:function(event){this.commentButtonIsActive=this.inlineCommentInput.value.trim().length>0;},updateConnectionWithComment:function(event){Event.kill(event);if(this.commentButtonIsActive){this.postInlineComment();this.resetInlineComment();this.closeInlineComment();}},postInlineComment:function(){this.postUserComment(this.inlineCommentInput.value.trim(),false,'iframe');},resetInlineComment:function(){this.concealCommentButton();var a=this.inlineCommentInput.getAttribute('placeholder');this.inlineCommentInput.value=a;},showInlineComment:function(event){Event.kill(event);if(!this.inlineCommentFlyoutOpen||this.inlineCommentFlyoutVisible||this.showConfirm||this.error)return;this.inlineCommentFlyoutVisible=true;CSS.show(this.inlineCommentFlyout);},hideInlineComment:function(event){Event.kill(event);if(this.inlineCommentFocused||!this.inlineCommentFlyoutOpen||!this.inlineCommentFlyoutVisible)return;if(DOM.contains(this.inlineCommentFlyout,event.getRelatedTarget()))return;var b=this.inlineCommentInput.value.trim();var a=this.inlineCommentInput.getAttribute('placeholder');if(b.length>0&&b!=a)return;this.inlineCommentFlyoutVisible=false;CSS.hide(this.inlineCommentFlyout);},closeInlineComment:function(){this.inlineCommentFlyoutVisible=false;this.inlineCommentFlyoutOpen=false;CSS.hide(this.inlineCommentFlyout);this.resetInlineComment();},concealCommentButton:function(){CSS.addClass(this.inlineCommentButton,'hidden_elem');CSS.setStyle(this.inlineCommentInput,'width',this.textInputWidthWithoutButton+'px');CSS.setStyle(this.inlineCommentInput,'margin-right',0);},positionInlineCommentFlyout:function(){CSS.addClass(this.inlineCommentFlyout,'comment_widget_offscreen');CSS.removeClass(this.inlineCommentFlyout,'hidden_elem');var b=0;var a=this.computeButtonDimensions();var e=a.height;var d=this.grayOut?b:b+20;var g=intl_locale_is_rtl()?'right':'left';if(this.showFaces){var k=DOM.scry(this.widget,'span.connect_widget_text')[0];var h=intl_locale_is_rtl()?'paddingRight':'paddingLeft';var l=CSS.getStyle(k,h);d=this.grayOut?b:b+parseInt(l,10);var i=Vector2.getElementDimensions(this.sampleConnections).y;e=i-3;}var j=Vector2.getElementDimensions(this.summaryText).y;if(j>15)e+=2;CSS.setStyle(this.inlineCommentFlyout,g,d+'px');CSS.setStyle(this.inlineCommentFlyout,'top',(-e)+'px');var n=Vector2.getElementPosition(this.widget,'document').x;var m=Vector2.getElementDimensions(this.widget).x;var o=n+m-d-5;CSS.setStyle(this.inlineCommentFlyout,'width',o+'px');CSS.removeClass(this.inlineCommentButton,'hidden_elem');var f=Vector2.getElementDimensions(this.inlineCommentButton).x;CSS.addClass(this.inlineCommentButton,'hidden_elem');var c=(this.inlineCommentClose)?15:0;this.textInputWidthWithoutButton=o-24-c;this.textInputWidthWithButton=this.textInputWidthWithoutButton-f-this.textInputMarginWithButton-1;CSS.setStyle(this.inlineCommentInput,'width',this.textInputWidthWithoutButton+'px');CSS.setStyle(this.inlineCommentInput,'margin-right',0);CSS.removeClass(this.inlineCommentFlyout,'comment_widget_offscreen');CSS.addClass(this.inlineCommentFlyout,'hidden_elem');},postUserComment:function(a,c,d){var b={href:this.externalUrl,node_type:this.nodeType,edge_type:this.edgeType,page_id:this.pageId,connect_text:this.connectText,story_fbid:this.connectStoryFbid,comment:a,widget_type:d||'xfbml',own_product:c};new AsyncRequest().setURI(this.getCommentAjaxEndpoint()).setData(b).setNectarModuleDataSafe().setNectarImpressionIdSafe().send();this.closeCommentWidget();},closeCommentWidget:function(){if(this.commentWidgetOpen){delete this.inGracePeriod;delete this.commentWidgetIsExpanded;this.commentWidgetVisible=false;this.commentWidgetOpen=false;UnverifiedXD.send({type:'dismissEdgeCommentDialog'});}},presentAdminPage:function(){var a='_blank';window.open(this.adminUrl.toString(),a);},presentErrorDialog:function(){if(!this.error.errorUri)return;var b='_blank';var a='toolbar=0, status=0, width=960, height=300';window.open(this.error.errorUri.toString(),b,a);},presentConfirmDialog:function(){var b='_blank';var a='toolbar=0,status=0,width=450,height=200,scrollbars=0,location=0,menubar=0';if(!window.confirmDialogReturn)window.confirmDialogReturn={};window.confirmDialogReturn[this.widgetID]=this;var c=this.getConfirmURL();window.open(c,b,a);},returnFromConfirmDialog:function(a){if(a){this.showConfirm=null;this.confirmedConnect=a;this.connectToNode(!this.alreadyConnected);}else this.updateWidget({nowConnected:this.alreadyConnected,showConfirm:null,isAdmin:this.viewerIsAdmin},false);},syncWidgetDisplay:function(){var a=this.alreadyConnected;this.setButtonState(a);this.showElementIf(this.connectedMessage,a);this.showElementIf(this.notConnectedMessage,!a);if(this.adminSpans)for(var b=0;b<this.adminSpans.length;b++)this.showElementIf(this.adminSpans[b],this.viewerIsAdmin);if(this.errorSpans)for(var c=0;c<this.errorSpans.length;c++)this.showElementIf(this.errorSpans[c],this.error&&(this.viewerIsAdmin||this.showError));for(var f=0;f<this.confirmSpans.length;f++)this.showElementIf(this.confirmSpans[f],!this.alreadyConnected&&this.showConfirm);for(var d=0;d<this.unlikeSpans.length;d++)this.showElementIf(this.unlikeSpans[d],this.alreadyConnected);if(this.shareCommentSpans)for(var e=0;e<this.shareCommentSpans.length;e++)this.showElementIf(this.shareCommentSpans[e],a);this.showElementIf(this.connectButton,(!this.useDisconnectLink||!a)&&!this.showConfirm);if(this.layout===ExternalNodeConnectWidget.BOX_COUNT_LAYOUT){this.manageBoxCountButtonAnimation(a);}else if(this.layout===ExternalNodeConnectWidget.BUTTON_COUNT_LAYOUT){this.manageButtonCountButtonAnimation(a);}else if(this.layout===ExternalNodeConnectWidget.SIMPLE_LAYOUT){this.manageSimpleButtonAnimation(a);}else this.manageStandardButtonAnimation(a);if(!this.loggedInUserPhotoDiv)return;if(a){this.slideUserPhotoIn(this.loggedInUserPhotoDiv);}else this.slideUserPhotoOut(this.loggedInUserPhotoDiv);},manageStandardButtonAnimation:function(a){if(this.grayOut)return;if(this.alreadyConnected||this.showConfirm){this.hideButton(true);}else this.hideButton(false);},setButtonState:function(a){if(a){CSS.removeClass(this.connectButton,'like_button_no_like');CSS.addClass(this.connectButton,'like_button_like');this.fixIEButtonDoubleLineBug();}else{CSS.addClass(this.connectButton,'like_button_no_like');CSS.removeClass(this.connectButton,'like_button_like');}},fixIEButtonDoubleLineBug:function(){if(this.layout===ExternalNodeConnectWidget.STANDARD_LAYOUT&&ua.ie()<=7&&!this.hasBeenFixed){var a=this.computeButtonDimensionsWithPadding();CSS.setStyle(this.connectButton,'width',a.width+1);this.hasBeenFixed=true;}},hideButton:function(a){if(this.layout!=='standard')return;if(this.oAnimateBlind)this.oAnimateBlind.stop();this.oAnimateBlind=animation(this.connectButtonSlider).duration(150);var c=1,b=intl_locale_is_rtl(),d=b?'marginRight':'marginLeft',e=b?'marginLeft':'marginRight';if(a){CSS.addClass(this.connectButtonContainer,'hidden');this.oAnimateBlind.ondone(function(){CSS.setStyle(this.connectButtonContainer,d,'2px');CSS.setStyle(this.connectButtonContainer,'visibility','hidden');CSS.addClass(this.confirmationCell,'connect_confirmation_cell_like');CSS.removeClass(this.confirmationCell,'connect_confirmation_cell_no_like');this.oAnimateBlind=null;}.bind(this));}else{CSS.setStyle(this.connectButtonContainer,d,'0px');c=Vector2.getElementDimensions(this.connectButton).x;this.oAnimateBlind.ondone(function(){CSS.setStyle(this.connectButtonSlider,'overflow','visible');CSS.setStyle(this.connectButtonSlider,'width','auto');CSS.removeClass(this.confirmationCell,'connect_confirmation_cell_like');CSS.addClass(this.confirmationCell,'connect_confirmation_cell_no_like');CSS.setStyle(this.connectButtonContainer,'visibility','visible');CSS.removeClass(this.connectButtonContainer,'hidden');this.oAnimateBlind=null;}.bind(this));}this.oAnimateBlind.to('width',c).blind().go();},showElementIf:function(a,b){if(!a)return;if(b){CSS.show(a);}else CSS.hide(a);},slideUserPhotoIn:function(b){if(!CSS.hasClass(b,'connect_widget_user_not_connected'))return;var a=CSS.getStyle(b,'width');CSS.setStyle(b,'width',0);CSS.setStyle(b,'opacity',0);CSS.removeClass(b,'connect_widget_user_not_connected');animation(b).to('width',a).duration(100).checkpoint().to('opacity',1).duration(400).go();},slideUserPhotoOut:function(a){if(CSS.hasClass(a,'connect_widget_user_not_connected'))return;animation(a).to('opacity',0).duration(100).checkpoint(.25).to('width',0).duration(100).ondone(function(){CSS.addClass(a,'connect_widget_user_not_connected');CSS.setStyle(a,'width',null);}).go();},primaryLikeButtonOnClick:function(event){if(this.grayOut&&this.alreadyConnected&&!this.mobile)return;this.connectToNodeOnClick(event);if(this.tombstoneCross&&this.alreadyConnected)DOM.replace(this.tombstoneCross,HTML('<div class="tombstone_cross tombstone_cross_static" />'));setTimeout(function(){this.tombstoneCross=DOM.find(this.widget,'div.tombstone_cross');CSS.removeClass(this.tombstoneCross,'tombstone_cross_static');Event.listen(this.tombstoneCross,'click',this.connectToNodeOnClick.bind(this));}.bind(this),1000);},_clickLocked:false,connectToNodeOnClick:function(event){Event.kill(event);if(!this._clickLocked){this._clickLocked=true;setTimeout(function(){this._clickLocked=false;}.bind(this),1000);if(this.viewerID==0||this.userOptedOut){this.presentOptIn();}else this.connectToNode(!this.alreadyConnected);}},connectToNode:function(d){if(!d){if(this.layout===ExternalNodeConnectWidget.SIMPLE_LAYOUT)return;if(this.layout===ExternalNodeConnectWidget.STANDARD_LAYOUT&&!this.usingConnectLibrary){CSS.addClass(this.userActionTextSpan,'hidden_elem');CSS.removeClass(this.summaryTextSpan,'hidden_elem');CSS.setStyle(this.summaryTextSpan,'opacity',1);}if(this.shareCommentSpans)for(var b=0;b<this.shareCommentSpans.length;b++)CSS.addClass(this.shareCommentSpans[b],'hidden_elem');if(this.commentWidgetOpen){this.closeCommentWidget();}else if(this.inlineCommentFlyoutOpen)this.closeInlineComment();}this.updateWidget({nowConnected:!this.alreadyConnected,isAdmin:this.viewerIsAdmin},true);var a={href:this.externalUrl,node_type:this.nodeType,edge_type:this.edgeType,page_id:this.pageId,layout:this.layout,is_personalized:this.isPersonalized,show_captcha:this.showCaptcha,connect_text:this.connectText,ref:this.ref,now_connected:d,post_form_id:$('post_form_id').value,iframe_referer:this.iframeReferer};if(this.confirmedConnect)a.confirm=1;new AsyncRequest().setURI(this.getAjaxEndpoint()).setHandler(this.syncWidgetWithServer.bind(this)).setData(a).setNectarModuleDataSafe().setNectarImpressionIdSafe().send();if(d){if(this.layout===ExternalNodeConnectWidget.BOX_COUNT_LAYOUT)this.requiresMouseLeaveEvent=true;if(this.layout===ExternalNodeConnectWidget.STANDARD_LAYOUT&&!this.usingConnectLibrary){CSS.setStyle(this.userActionTextSpan,'opacity',1);CSS.removeClass(this.userActionTextSpan,'hidden_elem');CSS.addClass(this.summaryTextSpan,'hidden_elem');Event.listen(this.widget,'mouseleave',this.transitionBetweenMessages.bind(this));}if(this.shareCommentSpans){for(var c=0;c<this.shareCommentSpans;c++)CSS.removeClass(this.shareCommentSpans[c],'hidden_elem');}else if(this.supportCommenting)this.presentCommentingOption();this.repositionFacepileVertically();}},transitionBetweenMessages:function(event){if(!this.alreadyConnected||CSS.hasClass(this.userActionTextSpan,'hidden_elem'))return;animation(this.userActionTextSpan).to('opacity',0).duration(500).ondone(function(){CSS.addClass(this.userActionTextSpan,'hidden_elem');CSS.setStyle(this.summaryTextSpan,'opacity',0);CSS.removeClass(this.summaryTextSpan,'hidden_elem');animation(this.summaryTextSpan).to('opacity',1).duration(500).ondone(function(){this.repositionFacepileVertically();}.bind(this)).go();this.positionInlineCommentFlyout();}.bind(this)).go();},presentCommentingOption:function(){Arbiter.inform('platform/socialplugins/dialog',{controllerID:this.widgetID,event:'open'});if(this.usingConnectLibrary){ExternalNodeConnectWidget.self=this;var a={type:'presentEdgeCommentDialog',masterFrameName:window.name,version:2};if(this.layout==ExternalNodeConnectWidget.BOX_COUNT_LAYOUT){a.preComputedWidthOffset=this.computeButtonDimensionsWithPadding().width;if(!intl_locale_is_rtl())a.preComputedWidthOffset+=8;}if(this.socialBar){a.left=parseInt(CSS.getStyle(document.getElementById('profile'),'width'),10)+1;}else if(this.hasSend&&this.layout==ExternalNodeConnectWidget.STANDARD_LAYOUT)a.preComputedWidthOffset=this.invertedButtons?0:65;UnverifiedXD.send(a);this.commentWidgetOpen=true;this.commentWidgetVisible=true;this.commentWidgetExpanded=true;}else if(this.usingInlineCommenting)if(!this.inlineCommentListenersInitialized){this.unwrapComment();this.initializeInlineCommentListeners();this.openInlineCommentFlyout();this.positionInlineCommentFlyout();this.inlineCommentListenersInitialized=true;}else{this.positionInlineCommentFlyout();this.openInlineCommentFlyout();}},unwrapComment:function(){if(this.unwrapComment.done)return;var b=$('connect-widget-comment-box-markup'),a=ExternalNodeConnectWidget.commentMarkup;b.innerHTML=a;this.unwrapComment.done=true;},initializeInlineCommentListeners:function(){this.inlineCommentFlyout=DOM.find(this.widget,'.connect_widget_comment_box');this.inlineCommentInput=DOM.find(this.inlineCommentFlyout,'.connect_widget_comment_textinput');this.inlineCommentButton=DOM.find(this.inlineCommentFlyout,'.connect_widget_comment_button');this.inlineCommentClose=DOM.scry(this.inlineCommentFlyout,'.connect_widget_comment_close_button');if(this.inlineCommentClose.length>0)this.inlineCommentClose=this.inlineCommentClose[0];this.commentButtonIsActive=false;Event.listen(this.inlineCommentInput,'keyup',this.conditionallyActivateButton.bind(this));Event.listen(this.inlineCommentInput,'focus',function(){this.inlineCommentFocused=true;this.exposeCommentButton();}.bind(this));Event.listen(this.inlineCommentButton,'click',this.updateConnectionWithComment.bind(this));Event.listen(this.inlineCommentInput,'blur',function(){this.inlineCommentFocused=false;this.hideInlineComment();}.bind(this));Event.listen(this.widget,'mouseout',this.hideInlineComment.bind(this));Event.listen(this.widget,'mouseover',this.showInlineComment.bind(this));if(this.inlineCommentClose)Event.listen(this.inlineCommentClose,'click',function(event){for(var a=0;a<this.shareCommentSpans.length;a++)CSS.removeClass(this.shareCommentSpans[a],'hidden_elem');this.closeInlineComment();}.bind(this));},exposeCommentButton:function(event){if(!CSS.hasClass(this.inlineCommentButton,'hidden_elem'))return;CSS.removeClass(this.inlineCommentButton,'hidden_elem');CSS.setStyle(this.inlineCommentInput,'width',this.textInputWidthWithButton+'px');CSS.setStyle(this.inlineCommentInput,'margin-right',this.textInputMarginWithButton+'px');},openInlineCommentFlyout:function(){CSS.show(this.inlineCommentFlyout);this.inlineCommentFlyoutOpen=true;this.inlineCommentFlyoutVisible=true;},manageBoxCountButtonAnimation:function(a){if(a&&!this.showConfirm){this.animateBoxCountButtonDisappearance();}else this.animateBoxCountButtonReappearance();},animateBoxCountButtonDisappearance:function(){if(this.grayOut)return;CSS.addClass(this.connectButton,'hidden_elem');CSS.setStyle(this.numberCloudExtension,'opacity',0);CSS.removeClass(this.numberCloudExtension,'hidden_elem');CSS.addClass(this.numberCloudNub,'hidden_elem');CSS.addClass(this.numberCloudUnlikeSpan,'hidden_elem');CSS.removeClass(this.numberCloudReminderSpan,'hidden_elem');animation(this.numberCloud).to('height',this.expandedNumberCloudHeight).duration(100).ondone(function(){animation(this.numberCloudExtension).from('opacity',0).to('opacity',1).duration(100).go();}.bind(this)).go();},animateBoxCountButtonReappearance:function(){CSS.addClass(this.numberCloudExtension,'hidden_elem');animation(this.numberCloud).to('height',this.collapsedNumberCloudHeight).duration(75).ondone(function(){if(this.showConfirm){for(var a=0;a<this.confirmSpans.length;a++)CSS.removeClass(this.confirmSpans[a],'hidden_elem');}else{CSS.setStyle(this.connectButton,'opacity',0);CSS.removeClass(this.connectButton,'hidden_elem');animation(this.connectButton).from('opacity',0).to('opacity',1).duration(75).ondone(function(){CSS.setStyle(this.numberCloudNub,'opacity',0);CSS.removeClass(this.numberCloudNub,'hidden_elem');animation(this.numberCloudNub).from('opacity',0).to('opacity',1).duration(50).go();}.bind(this)).go();}}.bind(this)).go();},manageButtonCountButtonAnimation:function(a){if(a&&!this.showConfirm){this.animateButtonCountButtonDisappearance();}else this.animateButtonCountButtonReappearance();if(!this.grayOut){CSS.removeClass(this.thumbsUpIcon,'hidden_elem');CSS.addClass(this.undoRegion,'hidden_elem');}},manageSimpleButtonAnimation:function(a){if(this.grayOut)return;if(a&&!this.showConfirm){this.animateSimpleButtonDisappearance();}else this.animateSimpleButtonReappearance();},animateButtonCountButtonDisappearance:function(){if(!this.grayOut)animation(this.connectButton).from('opacity',1).to('opacity',0).from('width',this.originalButtonWidth).to('width','0px').ondone(function(){CSS.addClass(this.connectButton,'hidden_elem');}.bind(this)).duration(100).go();animation(this.numberExcluding).from('opacity',1).to('opacity',0).duration(100).ondone(function(){CSS.addClass(this.numberExcluding,'hidden_elem');CSS.setStyle(this.summaryIncluding,'opacity',0);CSS.removeClass(this.summaryIncluding,'hidden_elem');animation(this.summaryIncluding).from('opacity',0).to('opacity',1).duration(100).go();}.bind(this)).go();for(var a=0;a<this.confirmSpans.length;a++)CSS.addClass(this.confirmSpans[a],'hidden_elem');if(this.grayOut)CSS.removeClass(this.connectButton,'hidden_elem');},animateSimpleButtonDisappearance:function(){animation(this.connectButton).from('opacity',1).to('opacity',0).from('width',this.originalButtonWidth).to('width','0px').ondone(function(){CSS.addClass(this.connectButton,'hidden_elem');CSS.setStyle(this.summaryIncluding,'opacity',0);CSS.removeClass(this.summaryIncluding,'hidden_elem');animation(this.summaryIncluding).from('opacity',0).to('opacity',1).duration(100).go();}.bind(this)).duration(50).go();for(var a=0;a<this.confirmSpans.length;a++)CSS.addClass(this.confirmSpans[a],'hidden_elem');if(this.grayOut)CSS.removeClass(this.connectButton,'hidden_elem');},computeButtonDimensions:function(){var c=CSS.hasClass(this.connectButton,'hidden_elem');if(c){CSS.addClass(this.connectButton,'connect_widget_offscreen');CSS.removeClass(this.connectButton,'hidden_elem');}var a=Vector2.getElementDimensions(this.connectButton);var d=a.x;var b=a.y;var f=parseInt(CSS.getStyle(this.connectButton,'paddingLeft'),10);var g=parseInt(CSS.getStyle(this.connectButton,'paddingRight'),10);var h=parseInt(CSS.getStyle(this.connectButton,'paddingTop'),10);var e=parseInt(CSS.getStyle(this.connectButton,'paddingBottom'),10);if(c){CSS.addClass(this.connectButton,'hidden_elem');CSS.removeClass(this.connectButton,'connect_widget_offscreen');}return {width:d-f-g-2,height:b};},computeButtonDimensionsWithPadding:function(){var c=CSS.hasClass(this.connectButton,'hidden_elem');if(c){CSS.addClass(this.connectButton,'connect_widget_offscreen');CSS.removeClass(this.connectButton,'hidden_elem');}var a=Vector2.getElementDimensions(this.connectButton);var d=a.x;var b=a.y;if(ua.ie())d+=3;if(c){CSS.addClass(this.connectButton,'hidden_elem');CSS.removeClass(this.connectButton,'connect_widget_offscreen');}return {width:d,height:b};},animateButtonCountButtonReappearance:function(){if(this.showConfirm){for(var a=0;a<this.confirmSpans.length;a++)CSS.removeClass(this.confirmSpans[a],'hidden_elem');}else if(!this.grayOut){CSS.removeClass(this.connectButton,'hidden_elem');animation(this.connectButton).from('width','0px').to('width',this.originalButtonWidth).from('opacity',0).to('opacity',1).duration(100).go();}CSS.setStyle(this.summaryIncluding,'opacity',1);animation(this.summaryIncluding).from('opacity',1).to('opacity',0).duration(100).ondone(function(){CSS.addClass(this.summaryIncluding,'hidden_elem');CSS.setStyle(this.numberExcluding,'opacity',0);CSS.removeClass(this.numberExcluding,'hidden_elem');animation(this.numberExcluding).from('opacity',0).to('opacity',1).duration(100).go();}.bind(this)).go();},animateSimpleButtonReappearance:function(){if(this.showConfirm){for(var a=0;a<this.confirmSpans.length;a++)CSS.removeClass(this.confirmSpans[a],'hidden_elem');}else{CSS.removeClass(this.connectButton,'hidden_elem');animation(this.connectButton).from('width','0px').to('width',this.originalButtonWidth).from('opacity',0).to('opacity',1).duration(100).go();}CSS.setStyle(this.summaryIncluding,'opacity',1);animation(this.summaryIncluding).from('opacity',1).to('opacity',0).duration(100).ondone(function(){CSS.addClass(this.summaryIncluding,'hidden_elem');}.bind(this)).go();},injectCommentWidgetMarkup:function(a){this.commentDocument=a;this.commentDocument.body.innerHTML=this.commentWidgetMarkup;this.transferCSSStyles();if(this.newProfilePic){var c=DOM.find(this.commentDocument,'img.connect_comment_widget_user_pic');c.src=this.newProfilePic;delete this.newProfilePic;}if(ua.ie()){var f=DOM.scry(this.commentDocument,'.connect_comment_share_preview_pic');if(f.length>0){f=f[0];var e=50;var d=Vector2.getElementDimensions(f);var g=e/d.x;if(g<1){CSS.setStyle(f,'width',e);CSS.setStyle(f,'height',d.y*g);}}}this.setupCommentHooks(this.commentDocument);this.commentWidgetIsExpanded=!this.inlineUnlikeLink;var b=this.getCommentActivatingComponent();b.onmouseout=this.commentDocument.body.onmouseout=this.onCommentMouseOut.bind(this);b.onmouseover=this.commentDocument.body.onmouseover=this.onCommentMouseOver.bind(this);this.inGracePeriod=false;},onCommentMouseOut:function(a){if(this.mouseclickToDismiss){this.mouseOutside=true;return true;}else return this.hideCommentWidget();},onCommentMouseOver:function(a){if(this.mouseclickToDismiss){this.mouseOutside=false;return true;}else return this.showCommentWidget();},setupCommentHooks:function(a){this.placeholderInputRegion=DOM.find(a,'div.connect_comment_widget_placeholder_input_region');this.placeholderInput=DOM.find(this.placeholderInputRegion,'input.connect_comment_widget_placeholder_input');this.fullInputRegion=DOM.find(a,'div.connect_comment_widget_full_input_region');this.fullInputTextarea=DOM.find(this.fullInputRegion,'textarea.connect_comment_widget_full_input_textarea');this.ownProductCheckbox=DOM.scry(a,'.connect_comment_widget_own_product_checkbox');if(this.ownProductCheckbox.length>0)this.ownProductCheckbox=this.ownProductCheckbox[0];this.widgetButtonRegion=DOM.find(a,'div.connect_comment_widget_button_region');this.postToFacebookButton=DOM.scry(this.widgetButtonRegion,'.connect_comment_widget_post_button input');if(this.postToFacebookButton.length>0){this.postToFacebookButton=this.postToFacebookButton[0];this.postToFacebookButton.onclick=this.updateUserComment.bind(this);}this.closeButton=DOM.scry(this.widgetButtonRegion,'.connect_comment_widget_close_button input');if(this.closeButton.length>0){this.closeButton=this.closeButton[0];this.closeButton.onclick=this.closeCommentWidget.bind(this);this.sendOnEnter=true;}this.mouseclickToDismiss=CSS.hasClass(this.widgetButtonRegion,'mouseclicktodismiss');this.inlineUnlikeLink=DOM.scry(a,'a.connect_comment_widget_unlike_link');if(this.inlineUnlikeLink.length>0){this.inlineUnlikeLink=this.inlineUnlikeLink[0];this.inlineUnlikeLink.onclick=this.connectToNodeOnClick.bind(this);}this.defaultInputText=this.placeholderInput.value;this.placeholderInput.onfocus=this.transitionToFullInputMode.bind(this);this.fullInputTextarea.onfocus=this.removePlaceholderText.bind(this);this.fullInputTextarea.onblur=(function(b){this.restorePlaceholderText();if(this.mouseclickToDismiss&&this.mouseOutside)return this.hideCommentWidget();}).bind(this);if(this.inlineUnlikeLink)this.inlineUnlikeLink.onclick=this.connectToNodeOnClick.bind(this);if(this.closeButton)this.closeButton.onclick=this.closeCommentWidget.bind(this);this.sendOnEnter=(CSS.hasClass(this.widgetButtonRegion,'sendonenter')||this.sendOnEnter);if(this.sendOnEnter){this.fullInputTextarea.onkeydown=(function(b){b=b||window.event;if(!b)return true;if(this.sendOnEnter&&b.keyCode==13&&!(b.ctrlKey||b.shiftKey||b.altKey||b.metaKey)){this.updateUserComment();return false;}if(this.didResetOnKeydown)return true;this.removePlaceholderText();this.didResetOnKeydown=true;return true;}).bind(this);this.transitionToFullInputMode();}},getCommentActivatingComponent:function(){if(this.layout===ExternalNodeConnectWidget.BOX_COUNT_LAYOUT||this.layout===ExternalNodeConnectWidget.BUTTON_COUNT_LAYOUT){return this.widget;}else if(this.layout===ExternalNodeConnectWidget.SIMPLE_LAYOUT){return this.widget;}else if(this.grayOut){return DOM.find(this.widget,'table.connect_widget_interactive_area');}else return this.confirmationCell;},showCommentWidget:function(event){if(this.otherCommentWidgetOpen)return false;this.inGracePeriod=true;this.killCloseThread();if(this.commentWidgetOpen&&!this.commentWidgetVisible){this.commentWidgetVisible=true;CSS.show(this.commentDocument.body);UnverifiedXD.send({type:'showEdgeCommentDialog'});}return false;},hideCommentWidget:function(event){if(this.otherCommentWidgetOpen)return false;this.inGracePeriod=false;if(this.commentWidgetOpen&&this.commentWidgetVisible){var a=function(){if(!this.inGracePeriod&&this.shouldHideExpandedWidget()){this.fullInputTextarea.blur();this.commentWidgetVisible=false;if(!this.socialBar)CSS.hide(this.commentDocument.body);UnverifiedXD.send({type:'hideEdgeCommentDialog'});}this.inGracePeriod=false;this.killCloseThread();}.bind(this);this.closeThreadID=setTimeout(a,100);}return false;},shouldHideExpandedWidget:function(){return !this.commentWidgetIsExpanded||this.fullInputTextarea.value===''||this.fullInputTextarea.value===this.defaultInputText;},killCloseThread:function(){if(this.closeThreadID){clearTimeout(this.closeThreadID);delete this.closeThreadID;}},transferCSSStyles:function(){var e=DOM.scry(window.document,'link');var f=DOM.scry(window.document,'style');var d=DOM.find(window.document,'html');var h=DOM.find(this.commentDocument,'html');var g=DOM.find(this.commentDocument,'head');for(var b=0;b<e.length;b++)if(e[b].rel=='stylesheet'){var c=this.commentDocument.createElement('link');c.rel=e[b].rel;c.href=e[b].href;c.type=e[b].type;g.appendChild(c);}for(b=0;b<f.length;b++){var i=this.commentDocument.createElement('style');var a=f[b].innerText||f[b].textContent||f[b].innerHTML;i.setAttribute("type","text/css");g.appendChild(i);if(i.styleSheet){i.styleSheet.cssText=a;}else{var j=this.commentDocument.createTextNode(a);i.appendChild(j);}}h.id=d.id;h.className=d.className;this.commentDocument.body.className=window.document.body.className;},transitionToFullInputMode:function(event){this.commentWidgetIsExpanded=true;CSS.hide(this.placeholderInputRegion);CSS.show(this.fullInputRegion);CSS.show(this.widgetButtonRegion);if(this.closeButton||this.sendOnEnter){this.restorePlaceholderText();var b=this.fullInputTextarea;if(document.selection){var a=b.createTextRange();a.collapse(true);a.moveEnd('character',0);a.moveStart('character',0);a.select();}else if(b.setSelectionRange){b.focus();b.setSelectionRange(0,0);}}return false;},removePlaceholderText:function(event){if(CSS.hasClass(this.fullInputTextarea,'connect_comment_widget_disabled')){CSS.removeClass(this.fullInputTextarea,'connect_comment_widget_disabled');this.fullInputTextarea.value='';}return false;},restorePlaceholderText:function(event){if(this.fullInputTextarea.value.trim()==''){this.fullInputTextarea.value=this.defaultInputText;CSS.addClass(this.fullInputTextarea,'connect_comment_widget_disabled');}return false;},updateUserComment:function(event){var b=this.fullInputTextarea.value.trim();var a=this.ownProductCheckbox.checked;if(b===''||b==this.defaultInputText){if(a===false)return false;b='';}this.postUserComment(b,a);return false;},getAjaxEndpoint:function(){return '/ajax/connect/external_node_connect.php';},getCommentAjaxEndpoint:function(){return '/ajax/connect/external_edge_comment.php';},getConfirmURL:function(){var a={href:this.externalUrl,page_id:this.pageId,node_type:this.nodeType,edge_type:this.edgeType,widget_id:this.widgetID};if(this.ref)a.ref=this.ref;return URI('/plugins/like_confirm.php').addQueryData(a).toString();},updateLoggedInUser:function(b,a){ExternalNodeConnectWidget.updateLoggedInUser(b,a);},syncSendWidgetWidth:function(h,b){var a=this.computeButtonDimensionsWithPadding().width;var c=b.button_width-a;if(this.layout===ExternalNodeConnectWidget.BOX_COUNT_LAYOUT&&c>0&&c<=5){CSS.setStyle(this.connectButton,'width',(b.button_width-parseInt(CSS.getStyle(this.connectButton,'paddingLeft'))-parseInt(CSS.getStyle(this.connectButton,'paddingRight'))-parseInt(CSS.getStyle(this.connectButton,'borderLeftWidth'))-parseInt(CSS.getStyle(this.connectButton,'borderRightWidth')))+'px');this.sizeNumberCloud();}if(this.layout===ExternalNodeConnectWidget.STANDARD_LAYOUT){var d=Vector2.getElementDimensions(this.widget).y;CSS.setStyle(this.widget,'height',(d+5)+'px');var e=ua.ie();var f=intl_locale_is_rtl();var g=f?'right':'left';if(e&&e<9){CSS.setStyle(this.connectButton,'position','absolute');CSS.setStyle(this.connectButton,g,-(b.button_width+10)+'px');}else{CSS.setStyle(this.connectButton,'position','fixed');CSS.setStyle(this.connectButton,g,'0px');}if(e&&this.connectButtonSlider){CSS.setStyle(this.connectButtonSlider,g,b.button_width+'px');if(e<=7)this.fixIEButtonDoubleLineBug();}CSS.setStyle(this.confirmationCell,'position','absolute');CSS.setStyle(this.confirmationCell,g,(b.button_width+a+5)+'px');CSS.setStyle(this.confirmationCell,'top','5px');if(this.sampleConnections){CSS.setStyle(this.sampleConnections,'position','fixed');CSS.setStyle(this.sampleConnections,g,'0');}this.invertedButtons=true;this.repositionFacepileVertically();}},repositionFacepileVertically:function(){if(this.invertedButtons&&this.sampleConnections){var a=Vector2.getElementDimensions(this.summaryText).y;CSS.setStyle(this.sampleConnections,'margin-top',(5+a+5)+'px');}}});
function ConnectWidget(h,f,a,e,b){copy_properties(this,{channel_url:b,like_mode:e,profile_id:f,viewer_id:h,status:null,popup:null,busy:false,new_fan:null,user_profile:null});this.fan_hidden=[];this.fan_shown=[];var c=DOM.scry(document,'div.connections');if(c.length>0){c=c[0];this.user_profile=DOM.find(c,'div.user_profile');this.new_fan=DOM.find(c,'div.grid_item_plus');this.fan_shown.push(this.new_fan);this.fan_shown.push(DOM.find(c,'span.total_plus'));var g=DOM.scry(c,'span.total');var d=DOM.scry(c,'div.grid_item');if(d.length>1)this.fan_hidden.push(d[1]);this.fan_hidden.push(g[g.length-1]);}if(!this.like_mode){this.button=$(a);this.popup_uri=new URI('/login.php');this.popup_uri.addQueryData({connect_id:this.profile_id,popup:true});Event.listen(this.button,'click',this.connectClickHandler.bind(this));}else Arbiter.subscribe('platform/like/connection',this.updateWidgetFromLike.bind(this));ConnectWidget.instances[a]=this;if(this.channel_url)XD.init({channelUrl:this.channel_url});}ConnectWidget.instances={};ConnectWidget.is_connect=true;ConnectWidget.prototype.setLoggedIn=function(a){this.viewer_id=a;return this;};ConnectWidget.prototype.connectClickHandler=function(a){a.kill();if(this.viewer_id!=0){this.connect();}else this.popUpLogin();};ConnectWidget.prototype.connect=function(){if(!this.busy){this.busy=true;fbpage_set_fan_status(this.button,this.profile_id,true,false,this.connectDoneHandler.bind(this),this.connectErrorHandler.bind(this),this.getAsyncData());}};ConnectWidget.prototype.disconnect=function(){if(!this.busy){this.busy=true;fbpage_set_fan_status(this.button,this.profile_id,false,false,this.connectUndoneHandler.bind(this),function(){},this.getAsyncData());}};ConnectWidget.prototype.getAsyncData=function(){var a={source:'connect',is_connect:ConnectWidget.is_connect};if(ge('post_form_id'))a.post_form_id=$('post_form_id').value;if(env_get('fb_dtsg'))a.fb_dtsg=env_get('fb_dtsg');return a;};ConnectWidget.prototype.popUpLogin=function(){window.open(this.popup_uri.toString(),'_blank','toolbar=0,status=0,width=626,height=400');};ConnectWidget.prototype.updateWidgetFromLike=function(b,f){if(!f.userProfile)return;if(this.user_profile){var c=DOM.find(this.user_profile,'img');var a=DOM.find(this.user_profile,'a');var e=DOM.find(this.user_profile,'div.name');c.src=f.userProfile.pic_square;a.href=f.userProfile.profile_url;DOM.setContent(e,f.userProfile.name);}var d;if(f.nowConnected){d='likeboxLiked';this.showNewFan();}else{d='likeboxUnliked';this.hideNewFan();}if(this.channel_url)XD.send({type:d});};ConnectWidget.prototype.connectErrorHandler=function(b){if(b.error==1357001){this.viewer_id=0;this.popUpLogin();}else if(b.error==1357013){CSS.hide(this.button);var a=$N('a',{href:DOM.find(document,'div.name_block a').href,target:'_blank'},_tx("Verification is needed to connect."));this.status=$N('span',{className:'connect_span'},a);DOM.insertAfter(this.button,this.status);}else{CSS.hide(this.button);if(b.error==1431001){this.status=$N('span',{className:'connect_span'},_tx("You like this."));}else this.status=$N('span',{className:'connect_span'},b.getErrorSummary()+': '+b.getErrorDescription());animation(this.status).from('opacity',0).to('opacity',1).go();DOM.insertAfter(this.button,this.status);}this.busy=false;};ConnectWidget.prototype.connectDoneHandler=function(c){var b=c.getPayload();if(!b||!b.feedback)return;this.status=$N('span',{className:'connect_span'},HTML(b.feedback));var d=$N('a',{className:'undo'},_tx("Undo"));Event.listen(d,'click',function(e){e.kill();this.disconnect();}.bind(this));DOM.appendContent(this.status,d);animation(this.status).from('opacity',0).to('opacity',1).go();DOM.insertAfter(this.button,this.status);CSS.hide(this.button);if(this.new_fan!=null&&b.connect_fan_div){var a=$N('div',{},HTML(b.connect_fan_div));DOM.setContent(this.new_fan,DOM.find(a,'a'));}this.showNewFan();this.busy=false;};ConnectWidget.prototype.showNewFan=function(){this.fan_shown.forEach(function(b){if(!CSS.hasClass(b,'hidden_elem'))return;var a=CSS.getStyle(b,'width');CSS.setStyle(b,'width',0);CSS.setStyle(b,'opacity',0);CSS.show(b);animation(b).to('width',a).duration(100).checkpoint().to('opacity',1).duration(400).go();});this.fan_hidden.forEach(function(a){CSS.hide(a);});};ConnectWidget.prototype.connectUndoneHandler=function(b){var a=b.getPayload();DOM.remove(this.status);animation(this.button).from('opacity',0).to('opacity',1).go();CSS.show(this.button);this.hideNewFan();this.busy=false;};ConnectWidget.prototype.hideNewFan=function(){this.fan_shown.forEach(function(a){if(CSS.hasClass(a,'hidden_elem'))return;animation(a).to('opacity',0).duration(100).checkpoint(.25).to('width',0).duration(100).ondone(function(){CSS.setStyle(a,'width',null);CSS.hide(a);this.fan_hidden.forEach(function(b){CSS.show(b);});}.bind(this)).go();}.bind(this));};ConnectWidget.loadStream=function(c,a,b){new AsyncRequest().setMethod('GET').setURI('/ajax/connect/connect_widget.php').setData({id:c,uniqid:a,force_wall:b}).setReadOnly(true).setErrorHandler(bagofholding).send();};ConnectWidget.loggedIn=function(c,a){if(ge('post_form_id')){DOM.replace($('post_form_id'),HTML(a));}else DOM.appendContent(DOM.find(document,'body'),HTML(a));for(var b in ConnectWidget.instances){ConnectWidget.instances[b].setLoggedIn(c);ConnectWidget.instances[b].connect();}};ConnectWidget.setIsConnect=function(a){ConnectWidget.is_connect=a;};
var ExternalPageLikeWidget=function(a){a.edgeType='like';this.parent.construct(this,a);this.unactionLink=DOM.scry(this.widget,'span.unlike_link')[0];if(this.unactionLink)Event.listen(this.unactionLink,'click',this.connectToNodeOnClick.bind(this));this.hasShowedInsights=false;this.showInsights();};Class.extend(ExternalPageLikeWidget,'ExternalNodeConnectWidget');ExternalPageLikeWidget.LIKE_EDGE_TYPE=0;ExternalPageLikeWidget.RECOMMEND_EDGE_TYPE=1;copy_properties(ExternalPageLikeWidget.prototype,{getSyncEndpointName:function(){var a=this.connectText?this.connectText:'like';if(a==ExternalPageLikeWidget.RECOMMEND_EDGE_TYPE)a='like';return 'platform/'+a+'/sync';},getConnectionEndpointName:function(){return 'platform/like/connection';},getPluginName:function(){return 'like';},presentInsightsPage:function(){window.open('/insights/?sk=po_'+this.pageId,'_blank');},showInsights:function(){if(this.hasShowedInsights||!this.pageId)return;var b=DOM.scry(this.widget,'a.connect_widget_insights_link');if(b)for(var a=0;a<b.length;a++){CSS.show(b[a].parentNode);Event.listen(b[a],'click',this.presentInsightsPage.bind(this));}this.hasShowedInsights=true;},repositionFacepileVertically:function(){this.showInsights();this.parent.repositionFacepileVertically();}});